<div
  class="group bg-white dark:bg-gray-800 rounded-2xl shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden border border-gray-100 dark:border-gray-700 flex flex-col h-full relative">

  <div class="relative h-48 overflow-hidden bg-gray-100 dark:bg-gray-700">
    <img [src]="sweet.imageUrl" [alt]="sweet.name"
      class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-500"
      [class.grayscale]="sweet.stockQuantity === 0">
    <span *ngIf="sweet.tag"
      class="absolute top-3 left-3 bg-yellow-400 text-yellow-900 text-xs font-bold px-2 py-1 rounded-md shadow-sm">{{
      sweet.tag }}</span>
    <div *ngIf="sweet.stockQuantity === 0"
      class="absolute inset-0 bg-black/50 flex items-center justify-center backdrop-blur-[2px]">
      <span
        class="bg-red-600 text-white px-4 py-1 rounded-full font-bold uppercase -rotate-12 border-2 border-white">Sold
        Out</span>
    </div>
  </div>

  <div class="p-5 flex flex-col flex-1">

    <div class="flex justify-between items-start mb-2">
      <h3 class="text-xl font-bold text-gray-800 dark:text-white line-clamp-1">{{ sweet.name }}</h3>
      <div class="text-right">
        <span class="text-lg font-bold text-orange-600 dark:text-orange-400">{{ priceDisplay() }}</span>
      </div>
    </div>

    <p class="text-gray-500 dark:text-gray-400 text-sm mb-4 line-clamp-2 flex-1">{{ sweet.description }}</p>

    <div *ngIf="sweet.stockQuantity > 0">

      <div *ngIf="sweet.unit === 'kg'" class="mb-3">
        <div class="flex p-1 bg-gray-100 dark:bg-gray-700 rounded-lg mb-3">
          <button (click)="toggleMode('kg')" class="flex-1 py-1 text-xs font-bold rounded-md transition-all"
            [ngClass]="buyMode() === 'kg' ? 'bg-white text-orange-600 shadow-sm' : 'text-gray-500'">Buy by Kg</button>
          <button (click)="toggleMode('piece')" class="flex-1 py-1 text-xs font-bold rounded-md transition-all"
            [ngClass]="buyMode() === 'piece' ? 'bg-white text-orange-600 shadow-sm' : 'text-gray-500'">Buy
            Pieces</button>
        </div>

        <select *ngIf="buyMode() === 'kg'" [ngModel]="selectedWeight()" (ngModelChange)="selectedWeight.set($event)"
          class="w-full p-2 text-sm border border-gray-200 rounded-lg bg-gray-50 dark:bg-gray-700 dark:text-white mb-2"
          (click)="$event.stopPropagation()">
          <option *ngFor="let opt of weightOptions" [ngValue]="opt.value">{{ opt.label }}</option>
        </select>
      </div>

      <div *ngIf="sweet.unit === 'piece' || (sweet.unit === 'kg' && buyMode() === 'piece')"
        class="flex items-center justify-between mb-3 bg-gray-50 dark:bg-gray-700 rounded-lg p-1 border border-gray-200 dark:border-gray-600">
        <button (click)="updatePieceCount(-1); $event.stopPropagation()"
          class="w-8 h-8 flex items-center justify-center bg-white dark:bg-gray-600 rounded shadow-sm hover:text-orange-600 font-bold">-</button>
        <span class="font-bold text-gray-800 dark:text-white">{{ pieceCount() }} {{ sweet.unit === 'kg' ? 'pcs' :
          'packs' }}</span>
        <button (click)="updatePieceCount(1); $event.stopPropagation()"
          class="w-8 h-8 flex items-center justify-center bg-white dark:bg-gray-600 rounded shadow-sm hover:text-orange-600 font-bold">+</button>
      </div>

    </div>

    <button (click)="onAddToCart($event)" [disabled]="sweet.stockQuantity === 0"
      class="w-full py-2 rounded-lg font-semibold transition-all bg-orange-100 text-orange-600 hover:bg-orange-600 hover:text-white">

      <span *ngIf="sweet.stockQuantity === 0">Out of Stock</span>

      <span *ngIf="sweet.stockQuantity > 0">
        <ng-container *ngIf="buyMode() === 'kg'">Add {{ selectedWeight() * 1000 }}g</ng-container>
        <ng-container *ngIf="buyMode() === 'piece'">Add {{ pieceCount() }} {{ sweet.unit === 'kg' ? 'Pcs' : 'Items'
          }}</ng-container>
      </span>
    </button>
  </div>
</div>